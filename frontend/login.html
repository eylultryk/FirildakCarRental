<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Fırıldak Kiralama - Giriş</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

<div class="container mt-5" style="max-width:500px">
  <h2 class="text-center mb-4">Kullanıcı Girişi</h2>

  <div class="card p-4 shadow-sm">
    <div class="mb-3">
      <label for="kadi" class="form-label">Kullanıcı Adı</label>
      <input type="text" class="form-control" id="kadi" autocomplete="username">
    </div>
    <div class="mb-3">
      <label for="sifre" class="form-label">Şifre</label>
      <input type="password" class="form-control" id="sifre" autocomplete="current-password">
    </div>
    <button id="btnGiris" class="btn btn-primary w-100" onclick="girisYap()">Giriş Yap</button>
  </div>

  <div id="mesaj" class="mt-3 text-center fw-semibold"></div>
</div>

<script>
  
  const TARGET_PAGE = "araclar.html"; 
  const API_URL = "https://localhost:7058/api/kullanici/giris";

  
  ["kadi","sifre"].forEach(id => {
    document.getElementById(id).addEventListener("keydown", e => {
      if (e.key === "Enter") girisYap();
    });
  });

  async function girisYap() {
    const btn = document.getElementById("btnGiris");
    const mesajAlani = document.getElementById("mesaj");
    const kullaniciAdi = document.getElementById("kadi").value.trim();
    const sifre = document.getElementById("sifre").value;

    mesajAlani.textContent = "";
    mesajAlani.className = "mt-3 text-center fw-semibold";
    if (!kullaniciAdi || !sifre) {
      mesajAlani.textContent = "Kullanıcı adı ve şifre zorunludur.";
      mesajAlani.classList.add("text-danger");
      return;
    }

    btn.disabled = true;
    btn.textContent = "Giriş yapılıyor...";

    try {
      const response = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ kullaniciAdi, sifre })
      });

      if (response.ok) {
        
        let id, adSoyad;
        try {
          const data = await response.json();
          id = data.id;
          adSoyad = data.adSoyad;
        } catch {  }

        if (id) localStorage.setItem("userId", id);
        if (adSoyad) localStorage.setItem("adSoyad", adSoyad);

        mesajAlani.textContent = "Giriş başarılı, yönlendiriliyorsunuz...";
        mesajAlani.classList.add("text-success");

        
        window.location.replace(TARGET_PAGE);
        return;
      } else {
        const text = await response.text();
        mesajAlani.textContent = text || "Giriş başarısız.";
        mesajAlani.classList.add("text-danger");
      }
    } catch (err) {
      mesajAlani.textContent = "Bağlantı hatası: " + err.message;
      mesajAlani.classList.add("text-danger");
    } finally {
      btn.disabled = false;
      btn.textContent = "Giriş Yap";
    }
  }
</script>

</body>
</html>
